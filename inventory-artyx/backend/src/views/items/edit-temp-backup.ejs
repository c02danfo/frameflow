<div class="space-y-6">
  <!-- Header -->
  <div class="flex items-center justify-between">
    <h2 class="text-2xl font-semibold text-gray-900">New Item</h2>
    <a href="/items" class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors shadow-sm">
      ← Back
    </a>
  </div>

  <!-- Form Card -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
    <form action="/items" method="POST" class="p-6">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        
        <!-- Name -->
        <div class="md:col-span-2 lg:col-span-3">
          <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Name <span class="text-red-500">*</span></label>
          <input type="text" name="name" id="name" required 
                 class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-colors" />
        </div>

        <!-- Category -->
        <div>
          <label for="category" class="block text-sm font-medium text-gray-700 mb-1">Category</label>
          <input type="text" name="category" id="category" list="categoryList"
                 class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-colors" />
          <datalist id="categoryList">
            <% if (categories && categories.length > 0) { %>
              <% categories.forEach(function(cat){ %>
                <option value="<%= cat %>"></option>
              <% }); %>
            <% } %>
          </datalist>
        </div>

        <!-- Supplier -->
        <div>
          <label for="supplier" class="block text-sm font-medium text-gray-700 mb-1">Supplier</label>
          <input type="text" name="supplier" id="supplier" list="supplierList"
                 class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-colors" />
          <datalist id="supplierList">
            <% if (suppliers && suppliers.length > 0) { %>
              <% suppliers.forEach(function(s){ %>
                <option value="<%= s %>"></option>
              <% }); %>
            <% } %>
          </datalist>
        </div>

        <!-- Color -->
        <div>
          <label for="color" class="block text-sm font-medium text-gray-700 mb-1">Color</label>
          <input type="text" name="color" id="color" placeholder="e.g., White, Black"
                 class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-colors" />
        </div>

        <!-- Stock Unit -->
        <div>
          <label for="stock_unit" class="block text-sm font-medium text-gray-700 mb-1">Stock Unit</label>
          <select name="stock_unit" id="stock_unit"
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-colors">
            <option value="">-- Select --</option>
            <option value="pieces">Pieces</option>
            <option value="sheets">Sheets</option>
            <option value="rolls">Rolls</option>
            <option value="meters">Meters</option>
            <option value="length_m">Length (m)</option>
          </select>
          <p class="mt-1 text-xs text-gray-500">How you count in warehouse</p>
        </div>

        <!-- Sales Unit -->
        <div>
          <label for="sales_unit" class="block text-sm font-medium text-gray-700 mb-1">Sales Unit</label>
          <select name="sales_unit" id="sales_unit"
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-colors">
            <option value="">-- Select --</option>
            <option value="m²">m² (area)</option>
            <option value="m">m (length)</option>
            <option value="pieces">Pieces</option>
            <option value="cm">cm</option>
          </select>
          <p class="mt-1 text-xs text-gray-500">How you price/sell</p>
        </div>

        <!-- Unit Size -->
        <div>
          <label for="unit_size" class="block text-sm font-medium text-gray-700 mb-1">
            Size of Unit (m/m²)
            <button type="button" class="ml-1 text-primary hover:text-primary-dark" title="How much sales unit in 1 stock unit? Examples: Glass 1000×1200mm: 1.2 (1 sheet = 1.2 m²)">ⓘ</button>
          </label>
          <input type="number" step="0.0001" name="unit_size" id="unit_size" placeholder="e.g., 1.2"
                 class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-colors" />
          <p class="mt-1 text-xs text-gray-500">Size of 1 stock unit in sales units</p>
        </div>

        <!-- Dimensions Section -->
        <div class="md:col-span-2 lg:col-span-3 mt-2">
          <h3 class="text-sm font-semibold text-gray-700 mb-3 border-b pb-2">Dimensions (optional)</h3>
        </div>

        <div>
          <label for="dim_width" class="block text-sm font-medium text-gray-700 mb-1">Width</label>
          <input type="number" step="0.01" name="dim_width" id="dim_width"
                 class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-colors" />
        </div>

        <div>
          <label for="dim_height" class="block text-sm font-medium text-gray-700 mb-1">Height</label>
          <input type="number" step="0.01" name="dim_height" id="dim_height"
                 class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-colors" />
        </div>

        <div>
          <label for="dim_length" class="block text-sm font-medium text-gray-700 mb-1">Length</label>
          <input type="number" step="0.01" name="dim_length" id="dim_length"
                 class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-colors" />
        </div>

        <div>
          <label for="dim_thickness" class="block text-sm font-medium text-gray-700 mb-1">Thickness</label>
          <input type="number" step="0.01" name="dim_thickness" id="dim_thickness"
                 class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-colors" />
        </div>

        <div>
          <label for="dim_unit" class="block text-sm font-medium text-gray-700 mb-1">Dimension Unit</label>
          <select name="dim_unit" id="dim_unit"
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-colors">
            <option value="mm">mm</option>
            <option value="cm">cm</option>
            <option value="m">m</option>
          </select>
        </div>

        <!-- Pricing Section -->
        <div class="md:col-span-2 lg:col-span-3 mt-2">
          <h3 class="text-sm font-semibold text-gray-700 mb-3 border-b pb-2">Pricing</h3>
        </div>

        <div>
          <label for="purchase_price" class="block text-sm font-medium text-gray-700 mb-1">
            Purchase Price
            <button type="button" class="ml-1 text-primary hover:text-primary-dark" title="Price per sales unit. Examples: Price per m² of glass, Price per meter of ramlist">ⓘ</button>
          </label>
          <input type="number" step="0.01" name="purchase_price" id="purchase_price"
                 class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-colors" />
        </div>

        <div>
          <label for="price_group" class="block text-sm font-medium text-gray-700 mb-1">Price Group</label>
          <select name="price_group" id="price_group"
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-colors">
            <option value="">-- Select --</option>
            <% if (price_groups && price_groups.length > 0) { %>
              <% price_groups.forEach(function(pg){ %>
                <option value="<%= pg.name %>" data-markup="<%= pg.markup_percentage %>"><%= pg.name %> (<%= pg.markup_percentage %>%)</option>
              <% }); %>
            <% } %>
          </select>
          <p class="mt-1 text-xs text-gray-500">Auto-calculates sales price</p>
        </div>

        <div>
          <label for="sales_price" class="block text-sm font-medium text-gray-700 mb-1">
            Sales Price
            <span id="suggested-badge" class="hidden ml-2 px-2 py-0.5 text-xs font-medium bg-sky-100 text-sky-700 rounded">Suggested</span>
          </label>
          <input type="number" step="0.01" name="sales_price" id="sales_price" placeholder="199.00"
                 class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-colors" />
          <p class="mt-1 text-xs text-gray-500">Can be manually overridden</p>
        </div>

        <!-- Info Alert -->
        <div class="md:col-span-2 lg:col-span-3 mt-2">
          <div class="bg-sky-50 border border-sky-200 rounded-lg p-3 flex items-start space-x-2">
            <svg class="w-5 h-5 text-sky-500 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
            </svg>
            <p class="text-sm text-sky-700">SKU is generated automatically (4 digits + 2 letters)</p>
          </div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="flex items-center gap-3 mt-6 pt-6 border-t border-gray-200">
        <button type="submit" class="inline-flex items-center px-6 py-2.5 bg-primary hover:bg-primary-dark text-white font-medium rounded-lg transition-colors shadow-sm">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
          </svg>
          Save Item
        </button>
        <a href="/items" class="inline-flex items-center px-6 py-2.5 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors">
          Cancel
        </a>
      </div>
    </form>
  </div>
</div>

<script>
  // Auto-calculate sales price based on price group and purchase price
  const priceGroupSelect = document.getElementById('price_group');
  const purchasePriceInput = document.getElementById('purchase_price');
  const salesPriceInput = document.getElementById('sales_price');
  const suggestedBadge = document.getElementById('suggested-badge');
  
  let manualOverride = false;
  
  // Track if user manually changes sales price
  salesPriceInput.addEventListener('input', function() {
    manualOverride = true;
    suggestedBadge.classList.add('hidden');
  });
  
  function calculateSalesPrice() {
    if (manualOverride) return;
    
    const selectedOption = priceGroupSelect.options[priceGroupSelect.selectedIndex];
    const markup = parseFloat(selectedOption.getAttribute('data-markup'));
    const purchasePrice = parseFloat(purchasePriceInput.value);
    
    if (markup && purchasePrice && purchasePrice > 0) {
      const suggestedPrice = (purchasePrice * markup / 100).toFixed(2);
      salesPriceInput.value = suggestedPrice;
      suggestedBadge.classList.remove('hidden');
      manualOverride = false; // Reset flag when auto-calculated
    } else {
      suggestedBadge.classList.add('hidden');
    }
  }
  
  priceGroupSelect.addEventListener('change', function() {
    manualOverride = false; // Reset override when changing price group
    calculateSalesPrice();
  });
  
  purchasePriceInput.addEventListener('input', calculateSalesPrice);
</script>
