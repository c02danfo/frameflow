<div class="bg-gray-50 min-h-screen">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Header -->
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 gap-4">
            <div>
                <h2 class="text-3xl font-bold text-gray-900">Tjänster</h2>
                <p class="text-sm text-gray-600 mt-1">Hantera tjänster för inramning</p>
            </div>
            <div class="flex flex-wrap gap-2">
                <a href="/services/new" class="inline-flex items-center px-4 py-2 bg-sky-600 hover:bg-sky-700 text-white font-semibold rounded-lg shadow-sm transition-colors">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                    </svg>
                    Ny tjänst
                </a>
            </div>
        </div>

        <!-- Filters -->
        <div class="bg-white rounded-lg shadow-sm p-4 mb-6">
            <form method="GET" action="/services" class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Sök</label>
                    <input type="text" name="q" value="<%= filters.q %>" placeholder="Namn, kategori, SKU..."
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Kategori</label>
                    <select name="category" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
                        <option value="">Alla kategorier</option>
                        <% categories.forEach(cat => { %>
                            <option value="<%= cat %>" <%= filters.category === cat ? 'selected' : '' %>><%= cat %></option>
                        <% }) %>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Prissättning</label>
                    <select name="pricingModel" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
                        <option value="">Alla</option>
                        <option value="fixed" <%= filters.pricingModel === 'fixed' ? 'selected' : '' %>>Fast pris</option>
                        <option value="hourly" <%= filters.pricingModel === 'hourly' ? 'selected' : '' %>>Timpris</option>
                        <option value="per_unit" <%= filters.pricingModel === 'per_unit' ? 'selected' : '' %>>Per enhet</option>
                        <option value="base_plus_hourly" <%= filters.pricingModel === 'base_plus_hourly' ? 'selected' : '' %>>Bas + timpris</option>
                    </select>
                </div>
                <div class="flex items-end gap-2">
                    <button type="submit" class="flex-1 px-4 py-2 bg-sky-600 hover:bg-sky-700 text-white font-medium rounded-lg transition-colors">
                        Filtrera
                    </button>
                    <a href="/services" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium rounded-lg transition-colors">
                        Rensa
                    </a>
                </div>
            </form>
        </div>

        <!-- Services Table (Desktop) -->
        <div class="hidden md:block bg-white rounded-lg shadow-sm overflow-hidden">
            <table class="min-w-full divide-y divide-gray-200" id="servicesTable">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortTable(0)">
                            SKU <span class="sort-arrow">↕</span>
                        </th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortTable(1)">
                            Namn <span class="sort-arrow">↕</span>
                        </th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortTable(2)">
                            Kategori <span class="sort-arrow">↕</span>
                        </th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortTable(3)">
                            Prissättning <span class="sort-arrow">↕</span>
                        </th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortTable(4)">
                            Pris <span class="sort-arrow">↕</span>
                        </th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortTable(5)">
                            Tid (min) <span class="sort-arrow">↕</span>
                        </th>
                        <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Åtgärder</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    <% if (services.length === 0) { %>
                        <tr>
                            <td colspan="7" class="px-4 py-8 text-center text-gray-500">
                                Inga tjänster hittades. <a href="/services/new" class="text-sky-600 hover:text-sky-700 font-medium">Skapa din första tjänst</a>
                            </td>
                        </tr>
                    <% } else { %>
                        <% services.forEach(service => { %>
                            <tr class="hover:bg-gray-50">
                                <td class="px-4 py-2 text-xs font-mono text-gray-600"><%= service.sku || '-' %></td>
                                <td class="px-4 py-2 text-sm text-gray-900"><%= service.name %></td>
                                <td class="px-4 py-2 text-xs text-gray-600"><%= service.category || '-' %></td>
                                <td class="px-4 py-2 text-xs">
                                    <% if (service.pricing_model === 'fixed') { %>
                                        <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">Fast</span>
                                    <% } else if (service.pricing_model === 'hourly') { %>
                                        <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800">Timpris</span>
                                    <% } else if (service.pricing_model === 'per_unit') { %>
                                        <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800">Per enhet</span>
                                    <% } else if (service.pricing_model === 'base_plus_hourly') { %>
                                        <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-orange-100 text-orange-800">Bas+Tim</span>
                                    <% } %>
                                </td>
                                <td class="px-4 py-2 text-xs text-gray-900">
                                    <% if (service.pricing_model === 'fixed') { %>
                                        <%= service.base_price ? service.base_price.toLocaleString('sv-SE') + ' kr' : '-' %>
                                    <% } else if (service.pricing_model === 'hourly') { %>
                                        <%= service.hourly_rate ? service.hourly_rate.toLocaleString('sv-SE') + ' kr/h' : '-' %>
                                    <% } else if (service.pricing_model === 'per_unit') { %>
                                        <%= service.price_per_unit ? service.price_per_unit.toLocaleString('sv-SE') + ' kr/' + (service.unit_type || 'st') : '-' %>
                                    <% } else if (service.pricing_model === 'base_plus_hourly') { %>
                                        <%= (service.base_price || 0).toLocaleString('sv-SE') %> + <%= (service.hourly_rate || 0).toLocaleString('sv-SE') %> kr/h
                                    <% } %>
                                </td>
                                <td class="px-4 py-2 text-xs text-gray-600"><%= service.default_duration_minutes || '-' %></td>
                                <td class="px-4 py-2 text-xs text-right space-x-2">
                                    <a href="/services/<%= service.id %>/view" class="inline-flex items-center justify-center p-2 text-slate-400 hover:text-sky-600 transition-colors" title="Visa">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                        </svg>
                                    </a>
                                    <a href="/services/<%= service.id %>/edit" class="inline-flex items-center justify-center p-2 text-slate-400 hover:text-amber-600 transition-colors" title="Redigera">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                        </svg>
                                    </a>
                                    <form method="POST" action="/services/<%= service.id %>/delete" class="inline" onsubmit="return confirm('Är du säker på att du vill radera denna tjänst?')">
                                        <button type="submit" class="inline-flex items-center justify-center p-2 text-slate-400 hover:text-red-600 transition-colors" title="Radera">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                            </svg>
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        <% }) %>
                    <% } %>
                </tbody>
            </table>
        </div>

        <!-- Services Cards (Mobile) -->
        <div class="md:hidden space-y-4">
            <% if (services.length === 0) { %>
                <div class="bg-white rounded-lg shadow-sm p-6 text-center text-gray-500">
                    Inga tjänster hittades. <a href="/services/new" class="text-sky-600 hover:text-sky-700 font-medium">Skapa din första tjänst</a>
                </div>
            <% } else { %>
                <% services.forEach(service => { %>
                    <div class="bg-white rounded-lg shadow-sm p-4">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex-1">
                                <h3 class="text-lg font-semibold text-gray-900"><%= service.name %></h3>
                                <p class="text-sm text-gray-500"><%= service.sku || 'SKU genereras automatiskt' %></p>
                            </div>
                            <% if (service.is_active) { %>
                                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">Aktiv</span>
                            <% } else { %>
                                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800">Inaktiv</span>
                            <% } %>
                        </div>
                        <div class="space-y-2 mb-4">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Kategori:</span>
                                <span class="font-medium"><%= service.category || '-' %></span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Prissättning:</span>
                                <span class="font-medium">
                                    <% if (service.pricing_model === 'fixed') { %>
                                        <%= service.base_price ? service.base_price.toLocaleString('sv-SE') + ' kr' : '-' %>
                                    <% } else if (service.pricing_model === 'hourly') { %>
                                        <%= service.hourly_rate ? service.hourly_rate.toLocaleString('sv-SE') + ' kr/h' : '-' %>
                                    <% } else if (service.pricing_model === 'per_unit') { %>
                                        <%= service.price_per_unit ? service.price_per_unit.toLocaleString('sv-SE') + ' kr/' + (service.unit_type || 'st') : '-' %>
                                    <% } else if (service.pricing_model === 'base_plus_hourly') { %>
                                        <%= (service.base_price || 0).toLocaleString('sv-SE') %> + <%= (service.hourly_rate || 0).toLocaleString('sv-SE') %> kr/h
                                    <% } %>
                                </span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Tid:</span>
                                <span class="font-medium"><%= service.default_duration_minutes ? service.default_duration_minutes + ' min' : '-' %></span>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <a href="/services/<%= service.id %>/view" class="flex-1 text-center px-3 py-2 bg-sky-50 text-sky-700 text-sm font-medium rounded-lg hover:bg-sky-100 transition-colors">
                                Visa
                            </a>
                            <a href="/services/<%= service.id %>/edit" class="flex-1 text-center px-3 py-2 bg-amber-50 text-amber-700 text-sm font-medium rounded-lg hover:bg-amber-100 transition-colors">
                                Redigera
                            </a>
                            <form method="POST" action="/services/<%= service.id %>/delete" class="flex-1" onsubmit="return confirm('Är du säker på att du vill radera denna tjänst?')">
                                <button type="submit" class="w-full px-3 py-2 bg-red-50 text-red-700 text-sm font-medium rounded-lg hover:bg-red-100 transition-colors">
                                    Radera
                                </button>
                            </form>
                        </div>
                    </div>
                <% }) %>
            <% } %>
        </div>
    </div>
</div>

<script>
let sortDirections = {};

function sortTable(columnIndex) {
    const table = document.getElementById('servicesTable');
    const tbody = table.querySelector('tbody');
    const rows = Array.from(tbody.querySelectorAll('tr')).filter(row => !row.querySelector('td[colspan]'));
    
    // Toggle sort direction
    sortDirections[columnIndex] = sortDirections[columnIndex] === 'asc' ? 'desc' : 'asc';
    const direction = sortDirections[columnIndex];
    
    rows.sort((a, b) => {
        let aValue = a.cells[columnIndex].textContent.trim();
        let bValue = b.cells[columnIndex].textContent.trim();
        
        // Handle numeric values (prices, time)
        if (columnIndex === 4 || columnIndex === 5) { // Pris or Tid
            aValue = parseFloat(aValue.replace(/[^0-9.-]/g, '')) || 0;
            bValue = parseFloat(bValue.replace(/[^0-9.-]/g, '')) || 0;
        }
        
        if (direction === 'asc') {
            return aValue > bValue ? 1 : aValue < bValue ? -1 : 0;
        } else {
            return aValue < bValue ? 1 : aValue > bValue ? -1 : 0;
        }
    });
    
    // Reappend sorted rows
    rows.forEach(row => tbody.appendChild(row));
    
    // Update arrow indicators
    table.querySelectorAll('.sort-arrow').forEach((arrow, index) => {
        if (index === columnIndex) {
            arrow.textContent = direction === 'asc' ? '↑' : '↓';
        } else {
            arrow.textContent = '↕';
        }
    });
}
</script>
